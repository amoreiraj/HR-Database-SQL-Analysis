-- ===============================================
-- 1. REGIONS
-- ===============================================
CREATE TABLE REGIONS (
    REGION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    REGION_NAME VARCHAR2(25) NOT NULL
);

COMMENT ON TABLE REGIONS IS 'Contains region IDs and names. Primary key for COUNTRIES.';
COMMENT ON COLUMN REGIONS.REGION_NAME IS 'Name of the region.';

-- ===============================================
-- 2. COUNTRIES
-- ===============================================
CREATE TABLE COUNTRIES (
    COUNTRY_ID CHAR(2) PRIMARY KEY,
    COUNTRY_NAME VARCHAR2(40) NOT NULL,
    REGION_ID NUMBER NOT NULL,
    CONSTRAINT FK_COUNTRIES_REGION FOREIGN KEY (REGION_ID) REFERENCES REGIONS(REGION_ID)
);

COMMENT ON TABLE COUNTRIES IS 'List of countries linked to REGIONS.';

-- ===============================================
-- 3. LOCATIONS
-- ===============================================
CREATE TABLE LOCATIONS (
    LOCATION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    STREET_ADDRESS VARCHAR2(40),
    POSTAL_CODE VARCHAR2(12),
    CITY VARCHAR2(30) NOT NULL,
    STATE_PROVINCE VARCHAR2(25),
    COUNTRY_ID CHAR(2) NOT NULL,
    LATITUDE NUMBER(9,6),
    LONGITUDE NUMBER(9,6),
    CONSTRAINT FK_LOCATIONS_COUNTRY FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES(COUNTRY_ID)
);

CREATE INDEX LOC_CITY_IX ON LOCATIONS(CITY);
CREATE INDEX LOC_STATE_PROVINCE_IX ON LOCATIONS(STATE_PROVINCE);
CREATE INDEX LOC_COUNTRY_IX ON LOCATIONS(COUNTRY_ID);

-- ===============================================
-- 4. JOBS
-- ===============================================
CREATE TABLE JOBS (
    JOB_ID VARCHAR2(20) PRIMARY KEY,
    JOB_TITLE VARCHAR2(35) NOT NULL,
    MIN_SALARY NUMBER,
    MAX_SALARY NUMBER
);

-- ===============================================
-- 5. DEPARTMENTS
-- ===============================================
CREATE TABLE DEPARTMENTS (
    DEPARTMENT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DEPARTMENT_NAME VARCHAR2(30) NOT NULL,
    MANAGER_ID NUMBER,
    LOCATION_ID NUMBER NOT NULL,
    CONSTRAINT FK_DEPARTMENTS_LOCATION FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS(LOCATION_ID),
    CONSTRAINT FK_DEPT_MANAGER FOREIGN KEY (MANAGER_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);



-- ===============================================
-- 6. EMPLOYEES
-- ===============================================
CREATE TABLE EMPLOYEES (
    EMPLOYEE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FIRST_NAME VARCHAR2(20),
    LAST_NAME VARCHAR2(25) NOT NULL,
    EMAIL VARCHAR2(25) UNIQUE NOT NULL,
    PHONE_NUMBER VARCHAR2(20),
    HIRE_DATE DATE NOT NULL,
    JOB_ID VARCHAR2(20) NOT NULL,
    SALARY NUMBER(8,2) CHECK (SALARY > 0),
    COMMISSION_PCT NUMBER(3,2),
    MANAGER_ID NUMBER,
    DEPARTMENT_ID NUMBER NOT NULL,
    CONSTRAINT FK_EMPLOYEES_JOB FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID),
    CONSTRAINT FK_EMPLOYEES_DEPT FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID),
    CONSTRAINT FK_EMPLOYEES_MANAGER FOREIGN KEY (MANAGER_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);

CREATE INDEX EMP_DEPARTMENT_IX ON EMPLOYEES (DEPARTMENT_ID);
CREATE INDEX EMP_JOB_IX ON EMPLOYEES (JOB_ID);
CREATE INDEX EMP_MANAGER_IX ON EMPLOYEES (MANAGER_ID);
CREATE INDEX EMP_NAME_IX ON EMPLOYEES (LAST_NAME, FIRST_NAME);

-- ===============================================
-- 7. JOB_HISTORY
-- ===============================================
CREATE TABLE JOB_HISTORY (
    EMPLOYEE_ID NUMBER NOT NULL,
    START_DATE DATE NOT NULL,
    END_DATE DATE NOT NULL CHECK (END_DATE > START_DATE),
    JOB_ID VARCHAR2(20) NOT NULL,
    DEPARTMENT_ID NUMBER NOT NULL,
    PRIMARY KEY (EMPLOYEE_ID, START_DATE),
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID),
    FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID),
    FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID)
);

-- ===============================================
-- 8. PERFORMANCE_REVIEWS
-- ===============================================
CREATE TABLE PERFORMANCE_REVIEWS (
    REVIEW_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER NOT NULL,
    REVIEW_DATE DATE NOT NULL,
    RATING NUMBER(3,1) CHECK (RATING BETWEEN 1 AND 5),
    COMMENTS CLOB,
    REVIEWER_ID NUMBER,
    CONSTRAINT FK_REVIEW_EMPLOYEE FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_REVIEW_REVIEWER FOREIGN KEY (REVIEWER_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);

-- ===============================================
-- 9. TRAINING_COURSES
-- ===============================================
CREATE TABLE TRAINING_COURSES (
    COURSE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    COURSE_NAME VARCHAR2(50) NOT NULL,
    COURSE_TYPE VARCHAR2(20),
    DURATION_HOURS NUMBER,
    START_DATE DATE,
    END_DATE DATE,
    CONSTRAINT CHK_COURSE_DATES CHECK (END_DATE > START_DATE OR END_DATE IS NULL)
);

-- ===============================================
-- 10. EMPLOYEE_SKILLS
-- ===============================================
CREATE TABLE EMPLOYEE_SKILLS (
    EMPLOYEE_ID NUMBER NOT NULL,
    SKILL_NAME VARCHAR2(50) NOT NULL,
    PROFICIENCY_LEVEL VARCHAR2(20),
    ACQUIRED_DATE DATE,
    PRIMARY KEY (EMPLOYEE_ID, SKILL_NAME),
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);

-- ===============================================
-- 11. ATTENDANCE
-- ===============================================
CREATE TABLE ATTENDANCE (
    ATTENDANCE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER NOT NULL,
    ATTENDANCE_DATE DATE NOT NULL,
    STATUS VARCHAR2(20) NOT NULL,
    HOURS_WORKED NUMBER(4,2) CHECK (HOURS_WORKED BETWEEN 0 AND 24 OR HOURS_WORKED IS NULL),
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);

-- ===============================================
-- 12. PAYROLL
-- ===============================================
CREATE TABLE PAYROLL (
    PAYROLL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMPLOYEE_ID NUMBER NOT NULL,
    PAY_PERIOD_START DATE NOT NULL,
    PAY_PERIOD_END DATE NOT NULL CHECK (PAY_PERIOD_END > PAY_PERIOD_START),
    BASE_SALARY NUMBER(8,2) NOT NULL CHECK (BASE_SALARY >= 0),
    BONUS NUMBER(8,2),
    DEDUCTIONS NUMBER(8,2),
    NET_PAY NUMBER(8,2) NOT NULL CHECK (NET_PAY >= 0),
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);

-- ===============================================
-- 13. RECRUITMENT
-- ===============================================
CREATE TABLE RECRUITMENT (
    APPLICATION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    JOB_ID VARCHAR2(20) NOT NULL,
    APPLICANT_NAME VARCHAR2(50) NOT NULL,
    APPLICATION_DATE DATE NOT NULL,
    STATUS VARCHAR2(20) NOT NULL,
    HIRE_DATE DATE,
    DEPARTMENT_ID NUMBER NOT NULL,
    FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID),
    FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID),
    CHECK (HIRE_DATE >= APPLICATION_DATE OR HIRE_DATE IS NULL)
);

-- ===============================================
-- 14. EMPLOYEE_TRAINING (Junction Table)
-- ===============================================
CREATE TABLE EMPLOYEE_TRAINING (
    EMPLOYEE_ID NUMBER NOT NULL,
    COURSE_ID NUMBER NOT NULL,
    COMPLETION_DATE DATE,
    PRIMARY KEY (EMPLOYEE_ID, COURSE_ID),
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID),
    FOREIGN KEY (COURSE_ID) REFERENCES TRAINING_COURSES(COURSE_ID)
);

